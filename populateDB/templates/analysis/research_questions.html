{% include "base.html" %}
{% include "navbar.html" %}

{% block content %}
<br>
	<div class="text-center">
                <h3>Research Questions</h3>
        </div>
        <hr />
    <section class="site_filter">
        <div class="container-fluid">
		<h5 class = "text-center"> 1. General Search:</h3>
		<div class="row">
                        <div class="col-sm-1 col-1">
                       		<select class="form-control" id="bat_names" url = "{%url 'populateDB:getBat_names' %}">
					<option value='all' selected"true" disabled="disabled">BAT Name</option>
                        	</select>
                        </div>

                        <div class="col-md-1 col-lg-1">
              			<input class="form-control" id="donor_names"   placeholder="Donor Abrr."> 
                        </div>
			<div class="form-group col-md-2 col-lg-2">
                                <select class="form-control" id="panel_names" url = "{%url 'populateDB:getPanel_names' %}">
					<option value='all' selected"true" disabled="disabled">Panel Name</option>
                                </select>
                        </div>
                        <div class="form-group col-md-2 col-lg-2">
                                <input class="form-control" id="marker_names" placeholder="Marker Contains..">
                        </div>

			<div class = "col-md-2 col-lg-2">
				<input type="date" class="form-control" id="date_min">
				
			</div>
			<div class = "col-md-2 col-lg-2">
				<input type="date" class="form-control" id="date_max">
                        </div>

                        <div class="col-md-2 col-lg-2">
                                <input class="form-control" id="allergens" placeholder="Allergen">
                        </div>
		</div>
		<div class="row">
			<div class="form-group col-md-2 col-lg-2">
                                <select class="form-control" id="file_controls" url = "{%url 'populateDB:getFile_controls' %}">
					<option value='all' selected"true" disabled="disabled">File Control</option>
                                </select>
                        </div>
			<div class="form-group col-md-2 col-lg-2">
                                <select id="OFC_classes" class="form-control">
                                        <option value="All" selected"true" disabled="disabled">OFC Class.</option>
                                </select>
			</div>

                        <div class="form-group col-md-2 col-lg-2">
                                <select class="form-control" id="clinical_classes" url = "{%url 'populateDB:getClinical_classes' %}">
					<option value='all' selected>clinical class.</option>
                                </select>
                        </div>

                        <div class="form-group col-md-2 col-lg-2">
                                <select id="analysis_results" class="form-control">
                                        <option value="All" selected="true" disabled="disabled">Results</option>
                                </select>
                        </div>

                        <div class="form-group col-md-2 col-lg-2">
                                <select class="form-control" id="responders" url = "{%url 'populateDB:getResponders' %}">
					<option value="All" selected>Responder</option>
                                </select>
                        </div>
			<div class="col-sm-2 col-2">
                                <div class="form-group">
                                        <select class="form-control" id="sort_by">
                                                <option selected="true"
                                                        disabled="disabled" value = "none">Sort By</option>
                                                <option value='bat_name'>bat_names</option>
                                                <option value='donor_name'>donor_names</option>
                                                <option value='bat_name'>panel_names</option>
                                        </select>
                                </div>
                        </div>

		</div>
		<hr />
		<h5 class = "text-center"> 2. Search based on a range in the results data:</h3>
		<div class="row">
                        <div class="form-group col-md-1 col-lg-1">
                               	<input class="form-check-input" type="checkbox" value="" id="redQ4" checked>
                               	<label class="form-check-label" for="redQ4">Red Q4</label>
                       	</div>
                       	<div class="form-group col-md-1 col-lg-1">
                               	<input class="form-control" id="redQ4_min" placeholder="min..">
                       	</div>
                       	<div class="form-group col-md-1 col-lg-1">
                               	<input class="form-control" id="redQ4_max" placeholder="max..">
                       	</div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-check-input" type="checkbox" value="" id="blackQ2" checked>
                                <label class="form-check-label" for="BlackQ2">Black Q2</label>
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="blackQ2_min" placeholder="min..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="blackQ2_max" placeholder="max..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-check-input" type="checkbox" value="" id="blackQ3" checked>
                                <label class="form-check-label" for="BlackQ3">Black Q3</label>
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="blackQ3_min" placeholder="min..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="blackQ3_max" placeholder="max..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-check-input" type="checkbox" value="" id="blackQ4" checked>
                                <label class="form-check-label" for="BlackQ4">Black Q4</label>
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="blackQ4_min" placeholder="min..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="blackQ4_max" placeholder="max..">
                        </div>

		</div>

                <div class="row">
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-check-input" type="checkbox" value="" id="zmeanQ4" checked>
                                <label class="form-check-label" for="zmeanQ4">Z Mean Q4</label>
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="zmeanQ4_min" placeholder="min..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="zmeanQ4_max" placeholder="max..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-check-input" type="checkbox" value="" id="CD63min" checked>
                                <label class="form-check-label" for="CD63min">CD63min</label>
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="CD63min_min" placeholder="min..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="CD63min_max" placeholder="max..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-check-input" type="checkbox" value="" id="CD63max" checked>
                                <label class="form-check-label" for="CD63max">CD63max</label>
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="CD63max_min" placeholder="min..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="CD63max_max" placeholder="max..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-check-input" type="checkbox" value="" id="msiCCR3" checked>
                                <label class="form-check-label" for="msiCCR3">msiCCR3</label>
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="msiCCR3_min" placeholder="min..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="msiCCR3_max" placeholder="max..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-check-input" type="checkbox" value="" id="cellQ4" checked>
                                <label class="form-check-label" for="cellQ4">cellQ4</label>
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="cellQ4_min" placeholder="min..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="cellQ4_max" placeholder="max..">
                        </div>

		</div>
                <hr />
                <h5 class="text-center"> 3. Search based on a range in the Classifications data</h3>

		<div class="row">
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-check-input" type="checkbox" value="" id="wheatFlour" checked>
                                <label class="form-check-label" for="wheatFlour">Wheat Flour</label>
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="wheatFlour_min" placeholder="min..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="wheatFlour_max" placeholder="max..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-check-input" type="checkbox" value="" id="gluten" checked>
                                <label class="form-check-label" for="gluten">gluten</label>
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="gluten_min" placeholder="min..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="gluten_max" placeholder="max..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-check-input" type="checkbox" value="" id="gliadin" checked>
                                <label class="form-check-label" for="gliadin">gliadin</label>
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="gliadin_min" placeholder="min..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="gliadin_max" placeholder="max..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-check-input" type="checkbox" value="" id="tri_a_19" checked>
                                <label class="form-check-label" for="tri_a_19">tri_a_19</label>
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="tri_a_19_min" placeholder="min..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="tri_a_19_max" placeholder="max..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-check-input" type="checkbox" value="" id="tri_a_19" checked>
                                <label class="form-check-label" for="tri_a_14">tri_a_14</label>
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="tri_a_14_min" placeholder="min..">
                        </div>
                        <div class="form-group col-md-1 col-lg-1">
                                <input class="form-control" id="tri_a_14_max" placeholder="max..">
                        </div>.
		</div>
		<hr />
		<div class="row justify-content-center">
			<div class="col-8">
				<div class="form-check form-switch">
                                	<input class="form-check-input" type="checkbox" id="mean_donor">
                                	<label class="form-check-label" for="mean_donor">Show only mean data for each donor</label>
                        
				</div>
			</div>
			<div class="col-2">
                        	<button type="button" id="reset_filters" class="btn btn-secondary">Reset Filters</button>
	                </div>
			<div class="col-2">
				<button type="button" id= "search" class="btn btn-primary"> Search</button>
			</div>
		</div>


        </div>
    </section>
    <br />
    <section>
        <div class="container-fluid">
            <div id = "result-count" class="text-right">
                <span class='font-weight-bold'></span> results found.
            </div>
            <div class="row properties_table justify-content-center">
                <div id = "no_results">
                    <h5>No results found</h5>
                </div>
                <table class="table table-striped table-hover" id="list_data" data-toggle="table" url = "{% url 'populateDB:list_results' %}">
                    <thead>
                        <tr>
                            <th data-field="bat_name">BAT Name</th>
			    <th data-field="donor_name">Donor Abbr.</th>
			    <th data-field="panel_name">Panel Name</th>
			    <th data-field="date_of_measurement">Date</th>
                            <th data-field="file_name">File Name</th>
			    <th data-field="file_allergen">File Allergen</th>
                            <th data-field="file_control">File Control</th>
			    <th data-field="clinical_class">Clinical Classifications</th>
                            <th data-field="OFC_class">OFC Classification</th>
                            <th data-field="wheat_flour">Wheat Flour</th>
			    <th data-field="redQ4">redQ4</th>
                            <th data-field="result">result</th>
                            <th data-field="blackQ2">blackQ2</th>
                            <th data-field="blackQ3">blackQ3</th>
                            <th data-field="blackQ4">blackQ4</th>
                            <th data-field="zmeanQ4">zmeanQ4</th>
                            <th data-field="CD63min">CD63min</th>
                            <th data-field="CD63max">CD63max</th>
                            <th data-field="msiCCR3">msiCCR3</th>
                            <th data-field="cellQ4">cellQ4</th>
                            <th data-field="responder">responder</th>
                            
                        </tr>
                    </thead>
                    <tbody id="list_results">
                    </tbody>
                </table>
            </div>
            <div class="row justify-content-center">
                <nav aria-label="navigation">
                    <ul class="pagination">
                        <li class="page-item">
                            <button class="btn btn-primary page-link" id="previous">Previous</button>
                        </li>
                        <li class="page-item pull-right">
                            <button class="btn btn-primary page-link" id="next">Next</button>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </section>
{% endblock %}

<style type="text/css">
    .properties_table{
    min-height: 755px;
    font-size: 14px;
    }
    .container-fluid{
        padding-right:50px;
        padding-left:50px;
    }
</style>

{% block javascript %}
<script>
        var send_data = {}

$(document).ready(function () {
    // reset all parameters on page load
    resetFilters();
    // bring all the data without any filters
    getAPIData();
    // get all countries from database via 
    // AJAX call into bat_name select options
    getBat_names();
    // get all varities from database via 
    // AJAX call into variert select options
    getPanel_names();
    getFile_controls();
    getClinical_classes();
    getResponders();
    getOFC_classes();
    getAnalysis_results();
    // on selecting the bat_name option
    $('#bat_names').on('change', function () {
        // update the selected bat_name
 	if(this.value == "all")
            send_data['bat_name'] = "";
        else
            send_data['bat_name'] = this.value;
        getAPIData();
    });

    // on filtering the donor_name input
    $('#donor_names').on('input', function () {
        // get the api data of updated donor_name
        if(this.value == "all")
            send_data['donor_name'] = "";
        else
            send_data['donor_name'] = this.value;
        getAPIData();
    });


    // on on selecting the panel_name option
    $('#panel_names').on('change', function () {
        // get the api data of updated panel_name
        if(this.value == "all")
            send_data['panel_name'] = "";
        else
            send_data['panel_name'] = this.value;
        getAPIData();
    });

    // on filtering the marker_name input
    $('#marker_names').on('input', function () {
        // get the api data of updated marker_name
        if(this.value == "all")
            send_data['marker_name'] = "";
        else
            send_data['marker_name'] = this.value;
        getAPIData();
    });
    // on filtering the date_min input
    $('#date_min').on('change', function () {
        // get the api data of updated date_min
        if(this.value == "all")
            send_data['date_min'] = "";
        else
            send_data['date_min'] = this.value;
        getAPIData();
    });
    // on filtering the file date_max input
    $('#date_max').on('change', function () {
        // get the api data of updated file date_max
        if(this.value == "all")
            send_data['date_max'] = "";
        else
            send_data['date_max'] = this.value;
        getAPIData();
    });
    // on filtering the file allergens input
    $('#allergens').on('input', function () {
        // get the api data of updated file allergens
        if(this.value == "all")
            send_data['allergens'] = "";
        else
            send_data['allergens'] = this.value;
        getAPIData();
    });

    // on filtering the file control input
    $('#file_controls').on('change', function () {
        // get the api data of updated file controls
        if(this.value == "all")
            send_data['file_controls'] = "";
        else
            send_data['file_controls'] = this.value;
        getAPIData();
    });
    // on filtering the file OFC_classes input
    $('#OFC_classes').on('change', function () {
        // get the api data of updated file OFC_classes
        if(this.value == "all")
            send_data['OFC_classes'] = "";
        else
            send_data['OFC_classes'] = this.value;
        getAPIData();
    });
    // on filtering the file clinical_classes input
    $('#clinical_classes').on('change', function () {
        // get the api data of updated file controls
        if(this.value == "all")
            send_data['clinical_classes'] = "";
        else
            send_data['clinical_classes'] = this.value;
        getAPIData();
    });
    // on filtering the file results input
    $('#analysis_results').on('change', function () {
        // get the api data of updated file results
        if(this.value == "all")
            send_data['analysis_results'] = "";
        else
            send_data['analysis_results'] = this.value;
        getAPIData();
    });
    // on filtering the file responders input
    $('#responders').on('input', function () {
        // get the api data of updated file responders
        if(this.value == "all")
            send_data['responders'] = "";
        else
            send_data['responders'] = this.value;
        getAPIData();
    });
    // on filtering the redQ4_min input
    $('#redQ4_min').on('input', function () {
        // get the api data of updated redQ4_min
        if(this.value == "all")
            send_data['redQ4_min'] = "";
        else
            send_data['redQ4_min'] = this.value;
        getAPIData();
    });
    // on filtering the file redQ4_max input
    $('#redQ4_max').on('input', function () {
        // get the api data of updated file date_max
        if(this.value == "all")
            send_data['redQ4_max'] = "";
        else
            send_data['redQ4_max'] = this.value;
        getAPIData();
    });
    // on filtering the blackQ2_min input
    $('#blackQ2_min').on('input', function () {
        // get the api data of updated redQ4_min
        if(this.value == "all")
            send_data['blackQ2_min'] = "";
        else
            send_data['blackQ2_min'] = this.value;
        getAPIData();
    });
    // on filtering the file blackQ2_max input
    $('#blackQ2_max').on('input', function () {
        // get the api data of updated file date_max
        if(this.value == "all")
            send_data['blackQ2_max'] = "";
        else
            send_data['blackQ2_max'] = this.value;
        getAPIData();
    });

    // on filtering the blackQ3_min input
    $('#blackQ3_min').on('input', function () {
        // get the api data of updated redQ4_min
        if(this.value == "all")
            send_data['blackQ3_min'] = "";
        else
            send_data['blackQ3_min'] = this.value;
        getAPIData();
    });
    // on filtering the file blackQ3_max input
    $('#blackQ3_max').on('input', function () {
        // get the api data of updated file date_max
        if(this.value == "all")
            send_data['blackQ3_max'] = "";
        else
            send_data['blackQ3_max'] = this.value;
        getAPIData();
    });

    // on filtering the blackQ4_min input
    $('#blackQ4_min').on('input', function () {
        // get the api data of updated redQ4_min
        if(this.value == "all")
            send_data['blackQ4_min'] = "";
        else
            send_data['blackQ4_min'] = this.value;
        getAPIData();
    });
    // on filtering the file blackQ4_max input
    $('#blackQ4_max').on('input', function () {
        // get the api data of updated file date_max
        if(this.value == "all")
            send_data['blackQ4_max'] = "";
        else
            send_data['blackQ4_max'] = this.value;
        getAPIData();
    });
    // on filtering the zmeanQ4_min input
    $('#zmeanQ4_min').on('input', function () {
        // get the api data of updated redQ4_min
        if(this.value == "all")
            send_data['zmeanQ4_min'] = "";
        else
            send_data['zmeanQ4_min'] = this.value;
        getAPIData();
    });
    // on filtering the file zmeanQ4_max input
    $('#zmeanQ4_max').on('input', function () {
        // get the api data of updated file date_max
        if(this.value == "all")
            send_data['zmeanQ4_max'] = "";
        else
            send_data['zmeanQ4_max'] = this.value;
        getAPIData();
    });
    // on filtering the CD63min_min input
    $('#CD63min_min').on('input', function () {
        // get the api data of updated redQ4_min
        if(this.value == "all")
            send_data['CD63min_min'] = "";
        else
            send_data['CD63min_min'] = this.value;
        getAPIData();
    });
    // on filtering the file CD63min_max input
    $('#CD63min_max').on('input', function () {
        // get the api data of updated file date_max
        if(this.value == "all")
            send_data['CD63min_max'] = "";
        else
            send_data['CD63min_max'] = this.value;
        getAPIData();
    });

    // on filtering the CD63max_min input
    $('#CD63max_min').on('input', function () {
        // get the api data of updated redQ4_min
        if(this.value == "all")
            send_data['CD63max_min'] = "";
        else
            send_data['CD63max_min'] = this.value;
        getAPIData();
    });
    // on filtering the file CD63max_max input
    $('#CD63max_max').on('input', function () {
        // get the api data of updated file date_max
        if(this.value == "all")
            send_data['CD63max_max'] = "";
        else
            send_data['CD63max_max'] = this.value;
        getAPIData();
    });

    // on filtering the msiCCR3_min input
    $('#msiCCR3_min').on('input', function () {
        // get the api data of updated redQ4_min
        if(this.value == "all")
            send_data['msiCCR3_min'] = "";
        else
            send_data['msiCCR3_min'] = this.value;
        getAPIData();
    });
    // on filtering the file msiCCR3_max input
    $('#msiCCR3_max').on('input', function () {
        // get the api data of updated file date_max
        if(this.value == "all")
            send_data['msiCCR3_max'] = "";
        else
            send_data['msiCCR3_max'] = this.value;
        getAPIData();
    });
    // on filtering the cellQ4_min input
    $('#cellQ4_min').on('input', function () {
        // get the api data of updated redQ4_min
        if(this.value == "all")
            send_data['cellQ4_min'] = "";
        else
            send_data['cellQ4_min'] = this.value;
        getAPIData();
    });
    // on filtering the file cellQ4_max input
    $('#cellQ4_max').on('input', function () {
        // get the api data of updated file date_max
        if(this.value == "all")
            send_data['cellQ4_max'] = "";
        else
            send_data['cellQ4_max'] = this.value;
        getAPIData();
    });
    // on filtering the wheatFlour_min input
    $('#wheatFlour_min').on('input', function () {
        // get the api data of updated redQ4_min
        if(this.value == "all")
            send_data['wheatFlour_min'] = "";
        else
            send_data['wheatFlour_min'] = this.value;
        getAPIData();
    });
    // on filtering the file wheatFlour_max input
    $('#wheatFlour_max').on('input', function () {
        // get the api data of updated file date_max
        if(this.value == "all")
            send_data['wheatFlour_max'] = "";
        else
            send_data['wheatFlour_max'] = this.value;
        getAPIData();
    });

    // on filtering the gluten_min input
    $('#gluten_min').on('input', function () {
        // get the api data of updated redQ4_min
        if(this.value == "all")
            send_data['gluten_min'] = "";
        else
            send_data['gluten_min'] = this.value;
        getAPIData();
    });
    // on filtering the file gluten_max input
    $('#gluten_max').on('input', function () {
        // get the api data of updated file date_max
        if(this.value == "all")
            send_data['gluten_max'] = "";
        else
            send_data['gluten_max'] = this.value;
        getAPIData();
    });
    // on filtering the gliadin_min input
    $('#gliadin_min').on('input', function () {
        // get the api data of updated redQ4_min
        if(this.value == "all")
            send_data['gliadin_min'] = "";
        else
            send_data['gliadin_min'] = this.value;
        getAPIData();
    });
    // on filtering the file gliadin_max input
    $('#gliadin_max').on('input', function () {
        // get the api data of updated file date_max
        if(this.value == "all")
            send_data['gliadin_max'] = "";
        else
            send_data['gliadin_max'] = this.value;
        getAPIData();
    });
    // on filtering the tri_a_19_min input
    $('#tri_a_19_min').on('input', function () {
        // get the api data of updated redQ4_min
        if(this.value == "all")
            send_data['tri_a_19_min'] = "";
        else
            send_data['tri_a_19_min'] = this.value;
        getAPIData();
    });
    // on filtering the file tri_a_19_max input
    $('#tri_a_19_max').on('input', function () {
        // get the api data of updated file date_max
        if(this.value == "all")
            send_data['tri_a_19_max'] = "";
        else
            send_data['tri_a_19_max'] = this.value;
        getAPIData();
    });
    // on filtering the tri_a_14_min input
    $('#tri_a_14_min').on('input', function () {
        // get the api data of updated redQ4_min
        if(this.value == "all")
            send_data['tri_a_14_min'] = "";
        else
            send_data['tri_a_14_min'] = this.value;
        getAPIData();
    });
    // on filtering the file tri_a_14_max input
    $('#tri_a_14_max').on('input', function () {
        // get the api data of updated file date_max
        if(this.value == "all")
            send_data['tri_a_14_max'] = "";
        else
            send_data['tri_a_14_max'] = this.value;
        getAPIData();
    });

    // sort the data according to price/points
    $('#sort_by').on('change', function () {
        send_data['sort_by'] = this.value;
        getAPIData();
    });

    // display the results after reseting the filters
    $("#reset_filters").click(function(){
        resetFilters();
        getAPIData();
    })
})



/**
    Function that resets all the filters   
**/
function resetFilters() {
    $("#bat_names").val("all");
    $("#donor_names").val("");
    $("#panel_names").val("all");
    $("#marker_names").val("");
    $("#date_min").val("");
    $("#date_max").val("");
    $("#allergens").val("");
    $("#file_controls").val("all");
    $("#OFC_classes").val("all");
    $("#clinical_classes").val("all");
    $("#analysis_results").val("all");
    $("#responders").val("all");
    $("#redQ4_min").val("");
    $("#redQ4_max").val("");
    $("#blackQ2_min").val("");
    $("#blackQ2_max").val("");
    $("#blackQ3_min").val("");
    $("#blackQ3_max").val("");
    $("#blackQ4_min").val("");
    $("#blackQ4_max").val("");
    $("#zmeanQ4_min").val("");
    $("#zmeanQ4_max").val("");
    $("#CD63min_min").val("");
    $("#CD63min_max").val("");
    $("#CD63max_min").val("");
    $("#CD63max_max").val("");
    $("#msiCCR3_min").val("");
    $("#msiCCR3_max").val("");
    $("#cellQ4_min").val("");
    $("#cellQ4_max").val("");
    $("#wheatFlour_min").val("");
    $("#wheatFlour_max").val("");
    $("#gluten_min").val("");
    $("#gluten_max").val("");
    $("#gliadin_min").val("");
    $("#gliadin_max").val("");
    $("#tri_a_19_min").val("");
    $("#tri_a_19_max").val("");
    $("#tri_a_14_min").val("");
    $("#tri_a_14_max").val("");
    $("#sort_by").val("none");


    send_data['bat_name'] = '';
    send_data['donor_name'] = '';
    send_data['panel_name'] = '';
    send_data['marker_name'] = '';
    send_data['date_min'] = '';
    send_data['date_max'] = '';
    send_data['allergens'] = '';
    send_data['file_controls'] = '';
    send_data['OFC_classes'] = '';
    send_data['clinical_classes'] = '';
    send_data['analysis_results'] = '';
    send_data['responders'] = '';
    send_data['redQ4_min'] = '';
    send_data['redQ4_max'] = '';
    send_data['blackQ2_min'] = '';
    send_data['blackQ2_max'] = '';
    send_data['blackQ3_min'] = '';
    send_data['blackQ3_max'] = '';
    send_data['blackQ4_min'] = '';
    send_data['blackQ4_max'] = '';
    send_data['zmeanQ4_min'] = '';
    send_data['zmeanQ4_max'] = '';
    send_data['CD63min_min'] = '';
    send_data['CD63min_max'] = '';
    send_data['CD63max_min'] = '';
    send_data['CD63max_max'] = '';
    send_data['msiCCR3_min'] = '';
    send_data['msiCCR3_max'] = '';
    send_data['cellQ4_min'] = '';
    send_data['cellQ4_max'] = '';
    send_data['wheatFlour_min'] = '';
    send_data['wheatFlour_max'] = '';
    send_data['gluten_min'] = '';
    send_data['gluten_max'] = '';
    send_data['gliadin_min'] = '';
    send_data['gliadin_max'] = '';
    send_data['tri_a_19_min'] = '';
    send_data['tri_a_19_max'] = '';
    send_data['tri_a_14_min'] = '';
    send_data['tri_a_14_max'] = '';
    send_data["sort_by"] = '',
    send_data['format'] = 'json';
}

/**.
    Utility function to showcase the api data 
    we got from backend to the table content
**/
function putTableData(result) {
    // creating table row for each result and
    // pushing to the html cntent of table body of results table
    let row;
    if(result["results"].length > 0){
        $("#no_results").hide();
        $("#list_data").show();
        $("#list_results").html("");  
        $.each(result["results"], function (a, b) {
            row = "<tr> <td>" + b.bat_name + "</td>" +
                "<td>" + b.donor_name + "</td>" +
		"<td>" + b.panel_name + "</td>" +
		"<td>" + b.date_of_measurement + "</td>" +
		"<td>" + b.file_name + "</td>" +
		"<td>" + b.allergen + "</td>" +
		"<td>" + b.control + "</td>" +
		"<td>" + b.clinicalClass_name + "</td>" +
		"<td>" + b.ofc_class + "</td>" +
                "<td>" + b.wheat_flour + "</td>" +
		"<td>" + b.redQ4 + "</td>" + 
    		"<td>" + b.result + "</td>" + 
    		"<td>" + b.blackQ2.toFixed(2)+ "</td>" +
    		"<td>" + b.blackQ3.toFixed(2) + "</td>" + 
    		"<td>" + b.blackQ4.toFixed(2) + "</td>" +
    		"<td>" + b.zmeanQ4.toFixed(2) + "</td>" + 
    		"<td>" + b.CD63min.toFixed(2) + "</td>" +
    		"<td>" + b.CD63max.toFixed(2) + "</td>" + 
    		"<td>" + b.msiCCR3.toFixed(2) + "</td>" + 
    		"<td>" + b.cellQ4 + "</td>" +
    		"<td>" + b.responder + "</td>" + 
            $("#list_results").append(row);   
        });
    }
    else{
        // if no result found for the given filter, then display no result
        $("#no_results h5").html("No results found");
        $("#list_data").hide();
        $("#no_results").show();
    }
    // setting previous and next page url for the given result
    let prev_url = result["previous"];
    let next_url = result["next"];
    // disabling-enabling button depending on existence of next/prev page. 
    if (prev_url === null) {
        $("#previous").addClass("disabled");
        $("#previous").prop('disabled', true);
    } else {
        $("#previous").removeClass("disabled");
        $("#previous").prop('disabled', false);
    }
    if (next_url === null) {
        $("#next").addClass("disabled");
        $("#next").prop('disabled', true);
    } else {
        $("#next").removeClass("disabled");
        $("#next").prop('disabled', false);
    }
    // setting the url
    $("#previous").attr("url", result["previous"]);
    $("#next").attr("url", result["next"]);
    // displaying result count
    $("#result-count span").html(result["count"]);
}

function getAPIData() {
    let url = $('#list_data').attr("url")
    $.ajax({
        method: 'GET',
        url: url,
        data: send_data,
        beforeSend: function(){
            $("#no_results h5").html("Loading data...");
        },
        success: function (result) {
            putTableData(result);
        },
        error: function (response) {
            $("#no_results h5").html("Something went wrong");
            $("#list_data").hide();
        }
    });
}

$("#next").click(function () {
    let url = $(this).attr("url");
    if (!url)
        $(this).prop('all', true);

    $(this).prop('all', false);
    $.ajax({
        method: 'GET',
        url: url,
        success: function (result) {
            putTableData(result);
        },
        error: function(response){
            console.log(response)
        }
    });
})

$("#previous").click(function () {
    let url = $(this).attr("url");
    if (!url)
        $(this).prop('all', true);

    $(this).prop('all', false);
    $.ajax({
        method: 'GET',
        url: url,
        success: function (result) {
            putTableData(result);
        },
        error: function(response){
            console.log(response)
        }
    });
})

function getBat_names() {
    let url = $("#bat_names").attr("url");
    $.ajax({
        method: 'GET',
        url: url,
        data: {},
        success: function (result) {
            bat_names_option = "<option value='all' selected>BAT Name</option>";
            $.each(result["bat_name"], function (a, b) {
                bat_names_option += "<option>" + b + "</option>"
            });
            $("#bat_names").html(bat_names_option)
        },
        error: function(response){
            console.log(response)
        }
    });
}

function getPanel_names() {
    let url = $("#panel_names").attr("url");
    $.ajax({
        method: 'GET',
        url: url,
        data: {},
        success: function (result) {
                panel_name_options = "<option value='all' selected>Panel Name</option>";
                $.each(result["panel_name"], function (a, b) {
                        panel_name_options += "<option>" + b + "</option>"
                });
                $("#panel_names").html(panel_name_options)
        },
        error: function(response){
                        console.log(response)
        }
  });
}

function getFile_controls() {
    let url = $("#file_controls").attr("url");
    $.ajax({
        method: 'GET',
        url: url,
        data: {},
        success: function (result) {
                fileControls_options = "<option value='all' selected>File Controls</option>";
                $.each(result["file_control"], function (a, b) {
                        fileControls_options += "<option>" + b + "</option>"
                });
                $("#file_controls").html(fileControls_options)
        },
        error: function(response){
                        console.log(response)
        }
  });
}

function getClinical_classes() {
    let url = $("#clinical_classes").attr("url");
    $.ajax({
        method: 'GET',
        url: url,
        data: {},
        success: function (result) {
                clinical_classes_options = "<option value='all' selected>Clinical Classification</option>";
                $.each(result["clinicalClass_name"], function (a, b) {
                        clinical_classes_options += "<option>" + b + "</option>"
                });
                $("#clinical_classes").html(clinical_classes_options)
        },
        error: function(response){
                        console.log(response)
        }
  });
}

function getResponders() {
    let url = $("#responders").attr("url");
    $.ajax({
        method: 'GET',
        url: url,
        data: {},
        success: function (result) {
                responders_options = "<option value='all' selected>Responders</option>";
                $.each(result["responder"], function (a, b) {
                        responders_options += "<option>" + b + "</option>"
                });
                $("#responders").html(responders_options)
        },
        error: function(response){
                        console.log(response)
        }
  });
}

function getOFC_classes() {
    let url = $("#OFC_classes").attr("url");
    $.ajax({
        method: 'GET',
        url: url,
        data: {},
        success: function (result) {
                OFC_classes_options = ["<option value='all' selected>OFC Classification</option>",
					"<option value='NA'>NA</option>",
					"<option value='negative'>negativ</option>",
					"<option value='positive'>positiv</option>"]; 

                $("#OFC_classes").html(OFC_classes_options)
        },
        error: function(response){
                        console.log(response)
        }
  });
}
function getAnalysis_results() {
    let url = $("#analysis_results").attr("url");
    $.ajax({
        method: 'GET',
        url: url,
        data: {},
        success: function (result) {
                analysis_results_options = ["<option value='all' selected>Results</option>",
                                        "<option value='negativ'>negativ</option>",
                                        "<option value='positiv'>positiv</option>"]; 

                $("#analysis_results").html(analysis_results_options)
        },
        error: function(response){
                        console.log(response)
        }
  });
}
</script>

{% endblock javascript %}
</body>
</html>

